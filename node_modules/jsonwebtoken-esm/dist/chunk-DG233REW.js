import{a as L}from"./chunk-V7SZSEPZ.js";import{a as H}from"./chunk-7MOKCY4R.js";import{a as Y}from"./chunk-K3PZSXDU.js";import{a as R,b as D}from"./chunk-UWRPOVMY.js";import{a as I}from"./chunk-Y7YQHRSK.js";import{a as G}from"./chunk-27KZZ7ZZ.js";import{b as N}from"./chunk-DWVGMGVC.js";import{a as B}from"./chunk-MIMLL23B.js";import{b as _,d as q,g as l,h as S,i as m}from"./chunk-IFOPAOBF.js";var k=_((O,T)=>{l();m();var n=G(),W=I(),b=L(),$=H(),C=B(),J=Y(),M=N(),z=D(),{KeyObject:F,createSecretKey:Q,createPublicKey:V}=R(),v=["RS256","RS384","RS512"],X=["ES256","ES384","ES512"],x=["RS256","RS384","RS512"],Z=["HS256","HS384","HS512"];M&&(v.splice(v.length,0,"PS256","PS384","PS512"),x.splice(x.length,0,"PS256","PS384","PS512"));T.exports=function(c,w,e,d){typeof e=="function"&&!d&&(d=e,e={}),e||(e={}),e=Object.assign({},e);let r;if(d?r=d:r=function(u,t){if(u)throw u;return t},e.clockTimestamp&&typeof e.clockTimestamp!="number")return r(new n("clockTimestamp must be a number"));if(e.nonce!==void 0&&(typeof e.nonce!="string"||e.nonce.trim()===""))return r(new n("nonce must be a non-empty string"));if(e.allowInvalidAsymmetricKeyTypes!==void 0&&typeof e.allowInvalidAsymmetricKeyTypes!="boolean")return r(new n("allowInvalidAsymmetricKeyTypes must be a boolean"));let y=e.clockTimestamp||Math.floor(Date.now()/1e3);if(!c)return r(new n("jwt must be provided"));if(typeof c!="string")return r(new n("jwt must be a string"));let A=c.split(".");if(A.length!==3)return r(new n("jwt malformed"));let f;try{f=$(c,{complete:!0})}catch(u){return r(u)}if(!f)return r(new n("invalid token"));let s=f.header,g;if(typeof w=="function"){if(!d)return r(new n("verify must be called asynchronous if secret or public key is provided as a callback"));g=w}else g=function(u,t){return t(null,w)};return g(s,function(u,t){if(u)return r(new n("error in secret or public key callback: "+u.message));let o=A[2].trim()!=="";if(!o&&t)return r(new n("jwt signature is required"));if(o&&!t)return r(new n("secret or public key must be provided"));if(!o&&!e.algorithms)return r(new n('please specify "none" in "algorithms" to verify unsigned tokens'));if(t!=null&&!(t instanceof F))try{t=V(t)}catch(a){try{t=Q(typeof t=="string"?S.from(t):t)}catch(E){return r(new n("secretOrPublicKey is not valid key material"))}}if(e.algorithms||(t.type==="secret"?e.algorithms=Z:["rsa","rsa-pss"].includes(t.asymmetricKeyType)?e.algorithms=x:t.asymmetricKeyType==="ec"?e.algorithms=X:e.algorithms=v),e.algorithms.indexOf(f.header.alg)===-1)return r(new n("invalid algorithm"));if(s.alg.startsWith("HS")&&t.type!=="secret")return r(new n(`secretOrPublicKey must be a symmetric key when using ${s.alg}`));if(/^(?:RS|PS|ES)/.test(s.alg)&&t.type!=="public")return r(new n(`secretOrPublicKey must be an asymmetric key when using ${s.alg}`));if(!e.allowInvalidAsymmetricKeyTypes)try{J(s.alg,t)}catch(a){return r(a)}let j;try{j=z.verify(c,f.header.alg,t)}catch(a){return r(a)}if(!j)return r(new n("invalid signature"));let i=f.payload;if(typeof i.nbf!="undefined"&&!e.ignoreNotBefore){if(typeof i.nbf!="number")return r(new n("invalid nbf value"));if(i.nbf>y+(e.clockTolerance||0))return r(new W("jwt not active",new Date(i.nbf*1e3)))}if(typeof i.exp!="undefined"&&!e.ignoreExpiration){if(typeof i.exp!="number")return r(new n("invalid exp value"));if(y>=i.exp+(e.clockTolerance||0))return r(new b("jwt expired",new Date(i.exp*1e3)))}if(e.audience){let a=Array.isArray(e.audience)?e.audience:[e.audience];if(!(Array.isArray(i.aud)?i.aud:[i.aud]).some(function(p){return a.some(function(h){return h instanceof RegExp?h.test(p):h===p})}))return r(new n("jwt audience invalid. expected: "+a.join(" or ")))}if(e.issuer&&(typeof e.issuer=="string"&&i.iss!==e.issuer||Array.isArray(e.issuer)&&e.issuer.indexOf(i.iss)===-1))return r(new n("jwt issuer invalid. expected: "+e.issuer));if(e.subject&&i.sub!==e.subject)return r(new n("jwt subject invalid. expected: "+e.subject));if(e.jwtid&&i.jti!==e.jwtid)return r(new n("jwt jwtid invalid. expected: "+e.jwtid));if(e.nonce&&i.nonce!==e.nonce)return r(new n("jwt nonce invalid. expected: "+e.nonce));if(e.maxAge){if(typeof i.iat!="number")return r(new n("iat required when maxAge is specified"));let a=C(e.maxAge,i.iat);if(typeof a=="undefined")return r(new n('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(y>=a+(e.clockTolerance||0))return r(new b("maxAge exceeded",new Date(a*1e3)))}if(e.complete===!0){let a=f.signature;return r(null,{header:s,payload:i,signature:a})}return r(null,i)})}});l();m();var K=q(k(),1);export{K as a};
//# sourceMappingURL=chunk-DG233REW.js.map
